<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.example.fpi.mapper.board.CommunityMapper">

    <!--  Community 목록 가져오기  -->
    <select id="communitySelectAll" resultType="CommunityDTO">
        SELECT *
        FROM (
                 SELECT ROWNUM AS RN, COMMUNITY.*
                 FROM (
                          SELECT
                              C.COMMUNITY_ID,
                              C.SUBJECT,
                              C.COMMUNITY_TITLE,
                              C.COMMUNITY_CONTENT,
                              U.USER_NAME,
                              C.COMMUNITY_REGISTER_DATE,
                              C.COMMUNITY_UPDATE_DATE,
                              U.USER_ID,
                              (SELECT COUNT(*) FROM TBL_LIKE L  WHERE L.COMMUNITY_ID = C.COMMUNITY_ID) AS LIKE_COUNT
                          FROM
                              TBL_COMMUNITY C JOIN TBL_USER U
                                               ON
                                                   U.USER_ID = C.USER_ID
                          ORDER BY
                              C.COMMUNITY_UPDATE_DATE DESC
                      ) COMMUNITY
                 WHERE ROWNUM &lt;= #{endRow}
             )
        WHERE rn &gt; #{startRow}
    </select>

    <!-- community 총 게시글의 갯수  -->
    <select id="countCommunity">
        select count(*)
        from tbl_Community
    </select>

    <!--  community 게시글 상세보기  -->
    <select id="selectCommunityDetail" resultType="CommunityDetailDTO">
        SELECT
            C.COMMUNITY_ID,
            C.COMMUNITY_TITLE,
            C.COMMUNITY_CONTENT,
            U.USER_NAME,
            C.Community_REGISTER_DATE,
            C.COMMUNITY_UPDATE_DATE,
            U.USER_ID,
            (SELECT COUNT(*) FROM TBL_LIKE L  WHERE L.COMMUNITY_ID = C.COMMUNITY_ID) AS LIKE_COUNT
        FROM
            TBL_COMMUNITY C JOIN TBL_USER U ON U.USER_ID = C.USER_ID
        where C.COMMUNITY_ID = #{communityId}
    </select>

<!--    insert에 사용    -->
    <select id="getSeq" resultType="long">
        select SEQ_COMMUNITY.nextval from dual
    </select>
<!--    작성  -->
    <insert id="saveCommunity">
        insert into TBL_COMMUNITY
        values(#{communityId}, #{subject}, #{communityTitle},#{communityContent}, sysdate, sysdate, #{userId})
    </insert>

<!--&lt;!&ndash;    수정  &ndash;&gt;-->
<!--    <update id="updateNoti">-->
<!--        update tbl_noti-->
<!--        set NOTI_TITLE = #{notiTitle},-->
<!--            NOTI_CONTENT = #{notiContent},-->
<!--            NOTI_UPDATE_DATE = sysdate-->
<!--        where NOTI_ID = #{notiId}-->
<!--    </update>-->

<!--    &lt;!&ndash;  Noti 게시글 삭제하기  &ndash;&gt;-->
<!--    <delete id="deleteNoti">-->
<!--        delete from TBL_NOTI-->
<!--        where NOTI_ID = #{notiId}-->
<!--    </delete>-->



</mapper>